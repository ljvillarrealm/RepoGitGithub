define(["librastandardlib/dom-utils/smoothScrollToElem","librastandardlib/dom-utils/breakpoint-helper","libra/p13n-utils/choiceManager","libra/nested-comp-utils/defaultItemSelection","librastandardlib/aws/page-settings","librastandardlib/event-utils/debounceWindowEvent","librastandardlib/event-utils/triggerCustomEvent","libra/dom-utils/smoothScrollOptions"],function(smoothScrollToElem,breakpointHelper,choiceManager,defaultItemSelection,PageSettings,debounceWindowEvent,triggerCustomEvent,smoothScrollOptions){"use strict";var defaults={eventNamespace:"aws_tabs",activeClass:"lb-active",triggerSelector:".lb-tabs-trigger",triggersGroupSelector:".lb-tabs-triggers",accordionTriggerClass:"lb-tabs-accordion-trigger",accordionHideContentClass:"lb-accordion-content-hide",tabNavPrevSelector:".lb-tabs-prev",tabNavNextSelector:".lb-tabs-next",tabContentGroupSelector:".lb-tabs-content",tabContentItemSelector:".lb-tabs-content-item",tabChangeEvent:"custom_lb-tabs_change",contentRevealEvent:"custom_lb-comp-content-container_reveal",transitionDoneWaitTime:300};var SCROLL_LEFT="left";var SCROLL_RIGHT="right";var NAV_NEXT="next";var NAV_PREV="prev";var BLOCK_SIZE_SM_DOWN=130;var BLOCK_SIZE_MD_UP=160;var BLOCK_SPACING=10;var SCROLL_DURATION=250;var Tabs=function(elem){this.$elem=$(elem);this.options=$.extend({},defaults,this.$elem.data());this.$tabContentGroup=this.$elem.children(this.options.tabContentGroupSelector);this.$tabContent=this.$tabContentGroup.children(this.options.tabContentItemSelector);this.$tabNavPrev=this.$elem.find(this.options.tabNavPrevSelector);this.$tabNavNext=this.$elem.find(this.options.tabNavNextSelector);this.$triggersGroup=this.$elem.children(this.options.triggersGroupSelector);this.$triggers=this.$triggersGroup.children(this.options.triggerSelector);this.$accordionTriggers=this.$tabContentGroup.children("."+this.options.accordionTriggerClass);this.numBlocks=this.$triggers.length;this.setDefaultTab();this.checkTabNav();this.bindHandlers()};Tabs.prototype={setDefaultTab:function(queryParam){var selTrigger=defaultItemSelection.getSelection(this.$elem,this.options.triggerSelector,queryParam);this.$elem.removeClass("lb-hide");if(selTrigger.length!==0){this.toggle(selTrigger[0],this.$triggers)}if(this.$elem.hasClass("lb-tabs-block")&&selTrigger.length!==0){this.scrollTabsByTabElement(selTrigger[0])}},bindHandlers:function(){var that=this;this.$triggersGroup.on("click","> li",function(e){e.preventDefault();that.toggle(this,that.$triggers)});this.$tabContentGroup.on("click","> ."+this.options.accordionTriggerClass,function(e){e.preventDefault();that.toggle(this,that.$accordionTriggers)});this.$tabNavPrev.on("click",function(e){e.preventDefault();that.scrollTabsByScrollCount(that.getScrollCount(),that.getScrollDirection(NAV_PREV))});this.$tabNavNext.on("click",function(e){e.preventDefault();that.scrollTabsByScrollCount(that.getScrollCount(),that.getScrollDirection(NAV_NEXT))});$(document).on("custom_libra_deep_link",function(event,queryParam){this.setDefaultTab(queryParam)}.bind(this));debounceWindowEvent(function(){this.checkTabNav()},"resize."+this.options.eventNamespace+"_check-block-nav",40,this)},checkIfAccordion:function(){this.isAccordion=false;if(this.$accordionTriggers.first().is(":visible")){this.isAccordion=true}},toggle:function(trigger,triggersList){this.$trigger=$(trigger);this.idx=triggersList.index(this.$trigger);this.$targetContent=this.$tabContent.eq(this.idx);this.$triggers.add(this.$accordionTriggers).removeClass(this.options.activeClass);this.$triggers.eq(this.idx).addClass(this.options.activeClass);this.$accordionTriggers.eq(this.idx).addClass(this.options.activeClass);this.checkIfAccordion();if(!this.$targetContent.hasClass(this.options.activeClass)||this.isAccordion&&this.$targetContent.hasClass(this.options.accordionHideContentClass)){this.expand(this.idx)}else if(this.$trigger.hasClass(this.options.accordionTriggerClass)){this.collapseAccordionsOnExpand();this.collapse()}defaultItemSelection.storeSelection(this.$elem,this.$trigger)},expand:function(){var trigger=this.$accordionTriggers.eq(this.idx);this.collapseOtherTabsOnExpand();this.collapseAccordionsOnExpand();this.$targetContent.removeClass(this.options.accordionHideContentClass);this.$targetContent.outerWidth();this.$targetContent.addClass(this.options.activeClass);this.$targetContent.trigger(this.options.tabChangeEvent);setTimeout(function(){this.$targetContent.trigger(this.options.contentRevealEvent)}.bind(this),this.options.transitionDoneWaitTime);if(this.isAccordion){smoothScrollToElem(trigger,smoothScrollOptions)}triggerCustomEvent("custom_lb_visibility_change",null,this.$targetContent[0])},collapse:function(){this.$trigger.removeClass(this.options.activeClass);this.$targetContent.trigger("custom_lb_comp-content-container_close");this.$targetContent.addClass(this.options.accordionHideContentClass);this.$targetContent.trigger(this.options.tabChangeEvent)},collapseOtherTabsOnExpand:function(){var $openContent=this.$tabContentGroup.children(this.options.tabContentItemSelector+"."+this.options.activeClass);$openContent.trigger("custom_lb_comp-content-container_close");$openContent.removeClass(this.options.activeClass)},collapseAccordionsOnExpand:function(){var $hiddenAccordionContent=this.$tabContentGroup.children("."+this.options.accordionHideContentClass);$hiddenAccordionContent.removeClass(this.options.accordionHideContentClass)},getBlockSize:function(){return breakpointHelper.isMidUp()?BLOCK_SIZE_MD_UP:BLOCK_SIZE_SM_DOWN},getScrollCount:function(){return breakpointHelper.isMidUp()?parseInt(this.options.lbScrollCount,10):1},getScrollDirection:function(forNav){if(document.documentMode===11||window.navigator.userAgent.indexOf("Edge")>-1){return forNav===NAV_NEXT?SCROLL_LEFT:SCROLL_RIGHT}if(forNav===NAV_PREV){return PageSettings.isRTL?SCROLL_LEFT:SCROLL_RIGHT}return PageSettings.isRTL?SCROLL_RIGHT:SCROLL_LEFT},getScrollAmount:function(scrollCount,direction){var scrollAmountPerCount=this.getBlockSize()+BLOCK_SPACING;var edgeBlocksInView=this.getEdgeBlocksInView();var blockAfterScroll=edgeBlocksInView.right+scrollCount;var blockBeforeScroll=edgeBlocksInView.left-scrollCount;var remainingBlock;if(PageSettings.isRTL){remainingBlock=direction===SCROLL_LEFT?blockBeforeScroll:this.numBlocks-blockAfterScroll}else{remainingBlock=direction===SCROLL_LEFT?this.numBlocks-blockAfterScroll:blockBeforeScroll}if(remainingBlock<=.5){scrollAmountPerCount*=2}return scrollAmountPerCount*scrollCount},getEdgeBlocksInView:function(){var scrollAmountPerCount=this.getBlockSize()+BLOCK_SPACING;var edgeBlocksInView={};var leftScrollPos=Math.abs(Math.floor(this.$triggersGroup.scrollLeft())+BLOCK_SPACING);edgeBlocksInView.right=(leftScrollPos+this.$triggersGroup.width())/scrollAmountPerCount;edgeBlocksInView.left=leftScrollPos/scrollAmountPerCount;return edgeBlocksInView},scrollTabsByScrollCount:function(scrollCount,direction){var scrollDirection=direction===SCROLL_LEFT?"+":"-";var scrollAmount=scrollDirection+"="+this.getScrollAmount(scrollCount,direction);this.$triggersGroup.animate({scrollLeft:scrollAmount},SCROLL_DURATION,this.checkTabNav.bind(this))},scrollTabsByTabElement:function(tabTriggerElem){var $tabTriggerElem=$(tabTriggerElem);if($tabTriggerElem.length>0){var elemPosition=$tabTriggerElem.position();var scrollAmount=elemPosition&&!isNaN(elemPosition.left)?elemPosition.left:0;var extraSpace=this.getBlockSize()+BLOCK_SPACING;scrollAmount="+="+(scrollAmount-extraSpace);this.$triggersGroup.animate({scrollLeft:scrollAmount},SCROLL_DURATION,this.checkTabNav.bind(this))}},checkTabNav:function(){var leftScrollPos=Math.abs(Math.floor(this.$triggersGroup.scrollLeft()));leftScrollPos===0?this.$tabNavPrev.addClass("hidden"):this.$tabNavPrev.removeClass("hidden");Math.round(this.getEdgeBlocksInView().right)>=this.numBlocks?this.$tabNavNext.addClass("hidden"):this.$tabNavNext.removeClass("hidden")}};Libra.Comp.register({name:"tabs",initFct:function(elem){new Tabs(elem)},initTime:"documentReady"});return Tabs});